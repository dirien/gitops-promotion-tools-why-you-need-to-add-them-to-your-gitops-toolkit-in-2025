---
name: Update Argo Rollouts Helm Chart

sources:
  argo-rollouts-chart-version:
    name: Get latest Argo Rollouts Helm chart version from OCI registry
    kind: helmchart
    spec:
      url: oci://ghcr.io/argoproj/argo-helm
      name: argo-rollouts

conditions:
  argo-rollouts-chart-published:
    name: Verify Argo Rollouts chart exists
    kind: helmchart
    sourceid: argo-rollouts-chart-version
    spec:
      url: oci://ghcr.io/argoproj/argo-helm
      name: argo-rollouts

targets:
  argo-rollouts-application:
    name: Update Argo Rollouts chart version
    kind: yaml
    sourceid: argo-rollouts-chart-version
    spec:
      file: gitops/base-tools/argo-rollouts/argo-rollouts.yaml
      key: $.spec.source.targetRevision
